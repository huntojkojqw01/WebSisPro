<%=provide(:title,"Bang diem ca nhan")%>
<div class="row">
	<div class="col-md-7">
		<div class="container" id="student_info">
			<div id="student_info_label">
				<p id="student_info_title">
					Thông tin sinh viên
				</p>
			</div>
			<div class="row" id="green_line">
			</div>
			<div class="container" id="student_info_board">
				<ul class="list-group">
					<li>Mã sinh viên: <b><%=current_sinhvien.masinhvien%></b></li>
					<li>Tên sinh viên: <b><%=current_sinhvien.tensinhvien%></b></li>
					<li>Ngày sinh: <b><%=current_sinhvien.ngaysinh%></b></li>
					<li>Lớp: <b><%=current_sinhvien.lopsinhvien.tenlopsinhvien%></b></li>
					<li>Email: <b><%=current_sinhvien.email%></b></li>
					<li>Trạng thái: <b><%= current_sinhvien.trangthai ? "Hoc" : "Thoi hoc"%></b></li>
				</ul>
			</div>
		</div>

		<table class="table table-striped">
			<thead>
				<tr>
					<th>Mã HK</th>
					<th>Mã HP</th>
					<th>Tên HP</th>
					<th>TC</th>
					<th>Mã LH</th>
					<th>Điểm QT</th>
					<th>Điểm thi</th>
					<th>Điểm chữ</th>
				</tr>
			</thead>
			<body>
				<%@lophocs.each do |lh| %>
				<tr>
					<%dk=lh.dangkilophocs.find_by(sinhvien_id:current_sinhvien.id)%>
					<td><%=lh.hocki.mahocki%></td>
					<td><%=lh.hocphan.mahocphan%></td>
					<td><%=lh.hocphan.tenhocphan%></td>
					<td><%=lh.hocphan.tinchi%></td>
					<td><%=lh.malophoc%></td>
					<td><%=dk.diemquatrinh%></td>
					<td><%=dk.diemthi%></td>
					<td><%=dk.diemchu%></td>

				</tr>
				<% end %>
			</body>
		</table>
		<%= will_paginate @lophocs ,renderer: BootstrapPagination::Rails, :outer_window=>1,:inner_window=>1%><br>
		<%= page_entries_info @lophocs %><br>
	</div>
	<div class="col-md-5">
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>Mã HK</th>
					<th>GPA</th>
					<th>CPA</th>
					<th>TC đạt</th>
					<th>TCDK</th>
					<th>TCTL</th>
					<th>TC nợ</th>
				</tr>
			</thead>
			<tbody>
				<%tcdangki=tcdat=tctichluy=cpa=gpa=tongdiem=tongdiemkhoa=0%>

				<% if @lophocs.count>0 %>
				<%hk=@lophocs.first.hocki%>
				<%@lophocs.each do |lh| %>

					<%hp=lh.hocphan%>
					<%dk=lh.dangkilophocs.find_by(sinhvien_id:current_sinhvien.id)%>
					<% if hk!=lh.hocki%>
						<tr>
							<td><%=hk.mahocki%></td><%hk=lh.hocki%><%gpa=tcdat>0 ? (tongdiem/tcdat).round(2) : 0%><%tongdiemkhoa+=tongdiem%><%tongdiem=0%><%cpa=tcdangki>0 ? (tongdiemkhoa/tcdangki).round(2) : 0%>
								<%tctichluy+=tcdat%>
							<td><%=gpa%></td><%gpa=0%>
							<td><%=cpa%></td>
							<td><%=tcdat%></td><%tcdat=0%>
							<td><%=tcdangki%></td>
							<td><%=tctichluy%></td>
							<td><%=tcdangki-tctichluy%></td>
						</tr>
					<%else%>

					<%end%>
					<%tcdangki+=hp.tinchi%>
					<%tcdat+=hp.tinchi if (dk.diemquatrinh || dk.diemthi)&&dk.diemso>=1.0%>
					<%tongdiem+=hp.tinchi*dk.diemso if dk.diemso%>
				<% end %>
				<tr>
							<td><%=hk.mahocki%></td><%gpa=tcdat>0 ? (tongdiem/tcdat).round(2) : 0%><%tongdiemkhoa+=tongdiem%><%tongdiem=0%><%cpa=tcdangki>0 ? (tongdiemkhoa/tcdangki).round(2) : 0%>
								<%tctichluy+=tcdat%>
							<td><%=gpa%></td>
							<td><%=cpa%></td>
							<td><%=tcdat%></td>
							<td><%=tcdangki%></td>
							<td><%=tctichluy%></td>
							<td><%=tcdangki-tctichluy%></td>
				</tr>
				<% end %>
			</body>
		</table>

	</div>
</div>
